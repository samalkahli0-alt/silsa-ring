<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ’ Ø§Ø¹Ø±Ù Ù…Ù‚Ø§Ø³Ùƒ â€” SILSA</title>

  <style>
    body{
      margin:0;
      background:#ffeed3;
      font-family:'Tajawal', sans-serif;
      color:#3e000c;
    }

    .wrap{
      max-width:1100px;
      margin:20px auto;
      padding:16px;
    }

    .card{
      background:#fff7ea;
      border:1px solid #f1d7b8;
      border-radius:14px;
      padding:16px;
      margin-bottom:20px;
    }

    #startCalib{
      width:100%;
      padding:12px;
      border:none;
      border-radius:12px;
      background:#b8860b;
      color:white;
      font-size:18px;
      cursor:pointer;
    }

    /* Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠØ±Ø© */
    #calibrationScreen{
      display:none;
      position:fixed;
      inset:0;
      background:rgba(0,0,0,0.85);
      color:white;
      padding:25px;
      text-align:center;
      z-index:99999;
    }

    #edgeHint{
      margin-bottom:10px;
      font-size:18px;
      text-align:right;
      color:#fff;
      margin-right:20px;
    }

    /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø­Ø§ÙØ© */
    #calibrationEdge{
      position:relative;
      width:80vw;
      max-width:450px;
      height:140px;
      margin-left:auto; 
      border-right:3px solid #ffffffaa;
      overflow:hidden;
      transition:margin-right .05s linear;
    }

    /* Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© */
    #cardBox{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      background:white;
      border:4px solid #3e000c;
      border-radius:10px;
      box-shadow:0 0 10px rgba(0,0,0,0.35);
      transition:right .05s linear;
    }

    #calibSlider{
      width:100%;
      margin-top:25px;
    }
  </style>

</head>
<body>

<div class="wrap">

  <div class="card">
    <h2>Ù…Ø¹Ø§ÙŠØ±Ø© Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©</h2>
    <p>Ø¶Ø¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¨Ø´ÙƒÙ„ Ø¹Ø±Ø¶ÙŠ Ø¨Ø­ÙŠØ« ÙŠØ¸Ù‡Ø± Ù†ØµÙÙ‡Ø§ Ø¯Ø§Ø®Ù„ Ø§Ù„Ø´Ø§Ø´Ø© ÙˆÙ†ØµÙÙ‡Ø§ Ø®Ø§Ø±Ø¬ØŒ Ø«Ù… Ø·Ø§Ø¨Ù‚ Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„ Ù…Ø¹Ù‡Ø§.</p>
    <button id="startCalib">Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¹Ø§ÙŠØ±Ø©</button>
    <div id="calibStatus" style="margin-top:10px;color:#7e4a55">Ù„Ù… ØªØªÙ… Ø§Ù„Ù…Ø¹Ø§ÙŠØ±Ø© Ø¨Ø¹Ø¯</div>
  </div>

</div>

<!-- Ø´Ø§Ø´Ø© Ø§Ù„Ù…Ø¹Ø§ÙŠØ±Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø© -->
<div id="calibrationScreen">

  <h2>ğŸ”§ Ø§Ù„Ù…Ø¹Ø§ÙŠØ±Ø©</h2>
  <p>Ø·Ø§Ø¨Ù‚ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø¸Ø§Ù‡Ø± Ù…Ù† Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù…Ø¹ Ø§Ù„Ù…Ø³ØªØ·ÙŠÙ„ Ø£Ø¯Ù†Ø§Ù‡:</p>

  <div id="edgeHint">â† Ø¶Ø¹ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ù‡Ù†Ø§</div>

  <div id="calibrationEdge">
    <div id="cardBox"></div>
  </div>

  <input type="range" id="calibSlider">

  <button id="doneCalib"
    style="margin-top:20px;padding:12px;border-radius:12px;
    background:#b8860b;color:white;border:none;font-size:17px;width:100%">
    Ø­ÙØ¸ ÙˆØ¥ØºÙ„Ø§Ù‚
  </button>

</div>

<script>

  /*****************************************
   * Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© (Ø§Ù„Ù…Ø¹Ø§ÙŠØ±Ø© Ø¹Ø¨Ø± Ø§Ù„Ø¹Ø±Ø¶)
   *****************************************/
  const CARD_WIDTH_MM  = 53.98;     // Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ (Ø§Ù„Ù…Ø¹Ø§ÙŠØ±Ø© Ø¹Ù„ÙŠÙ‡)
  const CARD_HEIGHT_MM = 85.6;      // Ø§Ù„Ø·ÙˆÙ„ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
  const CARD_RATIO     = CARD_HEIGHT_MM / CARD_WIDTH_MM;

  let scaleFactor = localStorage.scaleFactor ? parseFloat(localStorage.scaleFactor) : 6.8;
  let pxPerMM = scaleFactor;

  const calibScreen     = document.getElementById("calibrationScreen");
  const calibSlider     = document.getElementById("calibSlider");
  const cardBox         = document.getElementById("cardBox");
  const calibrationEdge = document.getElementById("calibrationEdge");
  const startCalib      = document.getElementById("startCalib");
  const doneCalib       = document.getElementById("doneCalib");
  const calibStatus     = document.getElementById("calibStatus");

  /*****************************************
   * ØªØ­Ø¯ÙŠØ« Ø­Ø¬Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© ÙˆØ­Ø±ÙƒØ© Ø§Ù„Ø­Ø§ÙØ©
   *****************************************/
  function updateCardBox(){
    const fullWidthPx  = parseFloat(calibSlider.value);
    const fullHeightPx = fullWidthPx * CARD_RATIO;

    // Ø­Ø¬Ù… Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ (Ù„ÙƒÙ† Ù†ØµÙÙ‡Ø§ ÙÙ‚Ø· ÙŠØ¸Ù‡Ø±)
    cardBox.style.width  = fullWidthPx + "px";
    cardBox.style.height = fullHeightPx + "px";

    // Ù†ØµÙ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø¯Ø§Ø®Ù„ â€” Ù†ØµÙÙ‡Ø§ Ø®Ø§Ø±Ø¬
    cardBox.style.right = -(fullWidthPx / 2) + "px";

    // Ø§Ù„Ø­Ø§ÙØ© ØªØªØ­Ø±Ùƒ Ø¨Ø­ÙŠØ« ØªØ¨Ù‚Ù‰ ÙÙŠ Ù…Ù†ØªØµÙ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø©
    calibrationEdge.style.marginRight = (fullWidthPx / 2) + "px";
  }

  /***********************
   * Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø¹Ø§ÙŠØ±Ø©
   ***********************/
  startCalib.addEventListener("click", ()=>{

    // Ù…Ø¯Ù‰ Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± ÙŠØ³Ù…Ø­ Ø¨Ø£Ù† ÙŠØµÙ„ Ø§Ù„Ø¹Ø±Ø¶ Ù„Ù„Ø­Ø¬Ù… Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ
    const maxPx = Math.round(window.innerWidth * 2);

    calibSlider.min   = 70;
    calibSlider.max   = maxPx;
    calibSlider.value = 120; 

    updateCardBox();
    calibScreen.style.display = "block";
  });

  calibSlider.addEventListener("input", updateCardBox);

  /***********************
   * Ø­ÙØ¸ scaleFactor
   ***********************/
  doneCalib.addEventListener("click", ()=>{

    const px = parseFloat(calibSlider.value);

    // scaleFactor = ÙƒÙ… Ø¨ÙƒØ³Ù„ Ù„ÙƒÙ„ 1 Ù…Ù„Ù…
    scaleFactor = px / CARD_WIDTH_MM;
    pxPerMM = scaleFactor;

    localStorage.setItem("scaleFactor", scaleFactor);

    calibStatus.textContent = "âœ” ØªÙ…Øª Ø§Ù„Ù…Ø¹Ø§ÙŠØ±Ø© Ø¨Ù†Ø¬Ø§Ø­";
    calibStatus.style.color = "green";

    calibScreen.style.display = "none";
  });

</script>

</body>
</html>

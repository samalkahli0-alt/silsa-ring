<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>💎 محاكاة مقاس الخاتم — SILSA</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#ffeed3; --ink:#3e000c; --muted:#7e4a55;
      --card:#fff7ea; --border:#f1d7b8;
      --accent:#b8860b; --accent2:#d4af37;
      --navy:#001f3f; --danger:#c81e1e;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font-family:'Tajawal',system-ui,Arial}
    .wrap{max-width:1100px;margin:24px auto;padding:16px}
    .title{font-size:26px;font-weight:800;margin:0 0 6px}
    .subtitle{color:var(--muted);margin:0 0 18px}
    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:16px}
    @media (max-width:880px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:18px;padding:16px}
    label{font-size:14px;color:var(--muted);display:block;margin-bottom:6px}
    input,select{width:100%;padding:10px 12px;border:1px solid var(--border);border-radius:12px;font-size:16px;background:#fff;outline:none;color:var(--ink)}
    input:focus,select:focus{border-color:var(--accent);box-shadow:0 0 0 3px rgba(212,175,55,.18)}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .full{grid-column:1/-1}
    .error{color:var(--danger);font-weight:800;margin-top:8px;min-height:1.5em}
    .laser{color:var(--navy);font-weight:800;margin-top:8px;white-space:pre-line;min-height:2.6em}
    .canvas-card{display:flex;flex-direction:column;align-items:center;gap:10px}
    svg{max-width:380px;height:auto;display:block}
    .ring-stroke{stroke:#8b2a2a;stroke-width:8;fill:url(#grad3d);filter:drop-shadow(0 4px 10px rgba(62,0,12,.25))}
    #grad3d stop:first-child{stop-color:#ffffff}
    #grad3d stop:last-child{stop-color:#d0bca7}
    .ring-stroke-inner{stroke:#fff;stroke-width:3;fill:none}
    .size-label{font-weight:800;margin-top:4px}
    .slider-wrap{display:flex;align-items:center;gap:10px;width:100%}
    input[type=range].size{appearance:none;width:100%;height:14px;border-radius:999px;background:#ead8bb;outline:none}
    input[type=range].size::-webkit-slider-thumb{appearance:none;width:24px;height:24px;border-radius:50%;background:var(--accent2);border:2px solid #fff;box-shadow:0 0 0 2px rgba(212,175,55,.35);cursor:pointer}
    .hint{font-size:12px;color:var(--muted)}
    .footer-note{margin-top:14px;font-weight:700;color:var(--ink);background:#fff3e0;border:1px solid var(--accent2);border-radius:12px;padding:8px 12px;text-align:center}
  </style>
</head>
<body>
  <div class="wrap">
    <h1 class="title">محاكاة مقاس الخاتم — SILSA 💍</h1>
    <div class="subtitle">اختاري المقاس وشاهدي الخاتم بالحجم الحقيقي على شاشتك. المعايرة تتم تلقائيًا حسب جهازك.</div>
    <div class="grid">
      <div class="card">
        <div class="row">
          <div>
            <label>سماكة الفضة (mm)</label>
            <select id="thickness">
              <option>1.0</option><option>1.2</option><option>1.5</option><option>1.75</option><option>2.0</option>
            </select>
          </div>
        </div>
        <div class="row" style="margin-top:12px">
          <div><label>المقاس الأمريكي (US)</label><input id="us" inputmode="decimal" placeholder="مثال: 7.5" /></div>
          <div><label>المقاس البريطاني (UK)</label><input id="uk" placeholder="مثال: K½" /></div>
          <div><label>المقاس الفرنسي (FR)</label><input id="fr" inputmode="decimal" placeholder="المحيط بالـ mm" /></div>
          <div><label>المقاس الياباني (JP)</label><input id="jp" inputmode="decimal" placeholder="مثال: 19" /></div>
          <div><label>القطر الداخلي (mm)</label><input id="diameter" inputmode="decimal" placeholder="مثال: 18.1" /></div>
          <div><label>المحيط (mm)</label><input id="circ" inputmode="decimal" placeholder="π × القطر" /></div>
          <div class="full error" id="error"></div>
          <div class="full laser" id="laser"></div>
        </div>
      </div>

      <div class="card canvas-card">
        <div id="sizeLabel" class="size-label">المقاس الحالي: — (US)</div>
        <svg id="ringSvg" viewBox="0 0 360 360">
          <defs>
            <radialGradient id="grad3d" cx="40%" cy="35%" r="65%">
              <stop offset="0%"/><stop offset="100%"/>
            </radialGradient>
          </defs>
          <circle id="outer" class="ring-stroke" cx="180" cy="190" r="60" />
          <circle id="inner" class="ring-stroke-inner" cx="180" cy="190" r="35" />
        </svg>
        <div class="slider-wrap">
          <span class="hint">4</span>
          <input id="slider" type="range" min="4" max="14" step="0.5" value="8" class="size" />
          <span class="hint">14</span>
        </div>
        <div class="footer-note">✨ هذا هو حجم الخاتم الحقيقي على شاشتك.</div>
      </div>
    </div>
  </div>

  <div id="mmProbe" style="position:absolute;left:-9999px;top:-9999px;width:10mm;height:1px;pointer-events:none;visibility:hidden;"></div>

  <script>
    const PI=Math.PI,US_MIN=4,US_MAX=14;
    const usToDiameter=us=>11.63+0.8128*us;
    const diameterToUs=d=>(d-11.63)/0.8128;
    const diameterToCirc=d=>PI*d;
    const usToFR=us=>diameterToCirc(usToDiameter(us));
    const usToJP=us=>us+12;
    const UK_STEPS=["H","H½","I","I½","J","J½","K","K½","L","L½","M","M½","N","N½","O","O½","P","P½","Q","Q½","R","R½","S","S½","T","T½","U","U½","V","V½","W","W½","X","X½","Y","Y½","Z","Z+½","Z+1"];
    const usToUK=us=>{const i=(us-US_MIN)/(US_MAX-US_MIN)*(UK_STEPS.length-1);return UK_STEPS[Math.max(0,Math.min(UK_STEPS.length-1,Math.round(i)))]};
    const normalizeUK=s=>s.trim().toUpperCase().replace("1/2","½");
    const ukToUs=uk=>{const i=UK_STEPS.indexOf(normalizeUK(uk));if(i<0)return null;return US_MIN+(i/(UK_STEPS.length-1))*(US_MAX-US_MIN)};

    const $=id=>document.getElementById(id);
    const el={thickness:$("thickness"),us:$("us"),uk:$("uk"),fr:$("fr"),jp:$("jp"),diameter:$("diameter"),circ:$("circ"),error:$("error"),laser:$("laser"),slider:$("slider"),sizeLabel:$("sizeLabel"),outer:$("outer"),inner:$("inner")};
    let updating=false,pxPerMM=6.8;
    const fmt=(n,d=2)=>Number(n).toFixed(d).replace(/\.0+$/,'').replace(/\.$/,'');
    const tryNum=v=>{if(v==null)return null;v=(""+v).trim();if(!v||v==='.'||v==='-'||v==='-.')return null;const n=Number(v);return Number.isFinite(n)?n:null};
    function setError(msg){el.error.textContent=msg||"";if(msg)el.laser.textContent=""}

    function drawRing(diameterMM){const rPx=(diameterMM/2)*pxPerMM;el.outer.setAttribute("r",rPx);el.inner.setAttribute("r",rPx/1.7);}
    function updateAllFromUS(us){if(us<US_MIN||us>US_MAX){setError("❌ المقاس خارج النطاق (4 – 14)");return;}setError("");const d=usToDiameter(us),c=diameterToCirc(d),fr=c,jp=usToJP(us),uk=usToUK(us);updating=true;el.us.value=fmt(us,2);el.uk.value=uk;el.fr.value=fmt(fr,1);el.jp.value=fmt(jp,1);el.diameter.value=fmt(d,2);el.circ.value=fmt(c,1);el.slider.value=us;updating=false;el.sizeLabel.textContent=`المقاس الحالي: ${fmt(us,1)} (US)`;drawRing(d);const t=parseFloat(el.thickness.value||"1");const laserVal=(d+t)*PI;el.laser.textContent=`القيمة المستخدمة في ماكينة الليزر: ${fmt(laserVal,1)} mm\n(سماكة الفضة: ${fmt(t,2)} mm)`;}

    // قياس فعلي للمليمتر من المتصفح
    function autoCalibrate(){
      const probe=document.getElementById('mmProbe');if(!probe)return;
      let pxFor10mm=probe.getBoundingClientRect().width;
      const vv=window.visualViewport;
      if(vv&&vv.scale&&vv.scale!==1)pxFor10mm/=vv.scale;
      pxPerMM=pxFor10mm/10;
      if(!(pxPerMM>2&&pxPerMM<30)){const dpr=window.devicePixelRatio||1;pxPerMM=(dpr*96)/25.4;}
      const currentD=tryNum(el.diameter.value)||usToDiameter(parseFloat(el.slider.value)||8);
      drawRing(currentD);
    }

    el.us.oninput=()=>{if(updating)return;const n=tryNum(el.us.value);if(n==null)return;updateAllFromUS(n)};
    el.uk.oninput=()=>{if(updating)return;const us=ukToUs(el.uk.value);if(us==null)return;updateAllFromUS(us)};
    el.fr.oninput=()=>{if(updating)return;const n=tryNum(el.fr.value);if(n==null)return;updateAllFromUS(diameterToUs(n/PI));};
    el.jp.oninput=()=>{if(updating)return;const n=tryNum(el.jp.value);if(n==null)return;updateAllFromUS(n-12)};
    el.diameter.oninput=()=>{if(updating)return;const n=tryNum(el.diameter.value);if(n==null)return;updateAllFromUS(diameterToUs(n))};
    el.circ.oninput=()=>{if(updating)return;const n=tryNum(el.circ.value);if(n==null)return;updateAllFromUS(diameterToUs(n/PI))};
    el.slider.oninput=()=>{if(updating)return;updateAllFromUS(parseFloat(el.slider.value))};
    el.thickness.onchange=()=>{const d=tryNum(el.diameter.value);if(d==null){el.laser.textContent="";return;}const t=parseFloat(el.thickness.value)||1;const laserVal=(d+t)*PI;el.laser.textContent=`القيمة المستخدمة في ماكينة الليزر: ${fmt(laserVal,1)} mm\n(سماكة الفضة: ${fmt(t,2)} mm)`};

    window.addEventListener('resize',()=>setTimeout(autoCalibrate,150));
    window.addEventListener('orientationchange',()=>setTimeout(autoCalibrate,250));
    document.addEventListener('DOMContentLoaded',()=>{updateAllFromUS(8);setTimeout(autoCalibrate,50);});
  </script>
</body>
</html>
